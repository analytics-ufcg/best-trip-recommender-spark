{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Análise Descritiva e exploratória\"\nauthor: \"Luiz Alberto Fonseca\"\ndate: \"August 30, 2017\"\noutput: html_document\n---\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE)\n```\n\n```{r}\n# libraries\nlibrary(plyr)\nlibrary(tidyverse)\nlibrary(ggplot2)\n```\n\n\n```{r}\n# Read files from one folder and bind them together into one df\n\ndata_directory_path = \"~/Analytics/MBServer/analise/testData\"\n\nfilenames <- list.files(data_directory_path, pattern=\"*.csv\", full.names=TRUE)\nlist_of_dataframes <- lapply(filenames, read.csv)\nbusData <- rbind.fill(list_of_dataframes)\n```\n\nAnálises posssíveis:\n\n2) um panorama das distâncias entre as paradas\n3) um panorama do número de shapes por rota\n4) um panorama do número de paradas por shape\n5) um panorama do tamanho dos shapes\n6) Relação entre duração entre uma parada e outra e a distância entre essas paradas\n7) panorama do periodo do dia e duração da viagem entre duas paradas\n8) Panorama entre o dia da semana e a duração da viagem entre duas paradas\n\nanalises que queremos:\n\n1) Relação entre a hora do dia e duração de uma viagem entre duas paradas\n2) Relação entre o dia da semana e a duração de uma viagem entre duas paradas\n3) Relação entre a área da cidade e a duração de uma viagem entre duas paradas\n\n\n## Hora do dia\nPrimeiro vamos plotar um gráfico de duração de viagens entre paradas por horas do dia.\n```{r}\np <- ggplot(busData, aes(x = as.factor(hourOrig), y = duration, colour = problem))\np + geom_jitter(aes(alpha = 0.5))\n```\n\nProblemas encontrados:\n\n1) Algumas durações estão negativas (pouquíssimos casos 8 em 190 mil da amostra).\n2) Algumas durações estão muito longas. Muitos desses casos ocorrem quando o número de viagem da origem é diferente do número de viagem do destino.\n\nHá um problema de cálculo no preprocessamento quando a parada de origem é a última parada do shape e a parada de destino é a primeira parada do shape.\nFiltrando esses casos obtemos o gŕafico abaixo.\n\n```{r}\ntemp <- busData %>% filter(distanceTraveledShapeDest > 0)\n\np <- ggplot(temp, aes(x = as.factor(hourOrig), y = duration, colour = problem))\np + geom_jitter(aes(alpha = 0.5))\n```\n\nHá casos em que o número da viagem do ponto de origem e o número da viagem do ponto de destino não são iguais (nem consecutivos?).\nFiltrando esses casos obtemos o gŕafico abaixo.\n\n```{r}\ntemp2 <- temp %>% filter(abs(tripNumOrig - tripNumDest) == 0)\n\np <- ggplot(temp2, aes(x = as.factor(hourOrig), y = duration, colour = problem))\np + geom_jitter(aes(alpha = 0.5))\n```\n\nNão é interessante que haja casos em que a parada de origem é igual à parada de destino. Vamos filtrar esses casos e visualizar como ficam os dados.\n\n```{r}\ntemp3 <- temp2 %>% filter(busStopIdOrig != busStopIdDest)\n\np <- ggplot(temp3, aes(x = as.factor(hourOrig), y = duration, colour = problem))\np + geom_jitter(aes(alpha = 0.5))\n```\n\nNão mudou muita coisa.\nHá casos em que simplesmente o ônibus demorou muito para ir de uma parada a outra e não se sabe exatamente o porquê.\n\nPodemos calcular a velocidade média do ônibus para ir de uma parada a outra. O resultado está no gráfico abaixo.\n\n```{r}\ntemp3 <- temp3 %>% mutate(velocityKmh = ((distance / duration) * 3.6))\n\np <- ggplot(temp3, aes(x = \"velocidade\", y = velocityKmh, colour = problem))\np + geom_jitter(aes(alpha = 0.5))\n```\n\nÀs vezes a velocidade é infinita (quando a duração é 0).\nHá muitas velocidades que não fazem sentido para um ônibus. \nA velocidade máxima para ônibus em trechos urbanos é de 90 km/h.\n\n```{r}\n# Filtrando velocidades irreais (muito altas)\ntemp4 <- temp3 %>% filter(velocityKmh <= 90)\n\n# filtrando viagens sem problemas\ntemp5 <- temp4 %>% filter(problem == \"NO_PROBLEM\")\n\np <- ggplot(temp5, aes(x = \"velocidade\", y = velocityKmh, colour = problem))\np + geom_jitter(aes(alpha = 0.5))\n\np + geom_boxplot()\n\np <- ggplot(temp5, aes(x = as.factor(hourOrig), y = duration, colour = problem))\np + geom_jitter(aes(alpha = 0.5))\n```\n\nHá alguns outliers que serão filtrados.\n\n```{r}\ntemp5 <- temp5 %>% filter(duration <= 1500)\n\np <- ggplot(temp5, aes(x = as.factor(hourOrig), y = duration, colour = problem))\np + geom_jitter(aes(alpha = 0.5))\n```\n chega de filtros por enquanto.\n \n \n```{r}\nwrite.csv(x = temp5, file = \"dadostratados.csv\", row.names = F)\n```\n",
    "created" : 1504632626387.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1828590918",
    "id" : "84352D1B",
    "lastKnownWriteTime" : 1504631726,
    "last_content_update" : 1504631726,
    "path" : "~/Analytics/MBServer/analise/wrangling.Rmd",
    "project_path" : "wrangling.Rmd",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}