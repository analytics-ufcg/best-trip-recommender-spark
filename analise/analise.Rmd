---
title: "Análise Descritiva e exploratória"
author: "Luiz Alberto Fonseca"
date: "August 30, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# libraries
library(plyr)
library(tidyverse)
library(ggplot2)
```


```{r}
# Read files from one folder and bind them together into one df

data_directory_path = "testData/"

filenames <- list.files(data_directory_path, pattern="*.csv", full.names=TRUE)
list_of_dataframes <- lapply(filenames, read.csv)
busData <- rbind.fill(list_of_dataframes)
```

Análises posssíveis:

2) um panorama das distâncias entre as paradas
3) um panorama do número de shapes por rota
4) um panorama do número de paradas por shape
5) um panorama do tamanho dos shapes
6) Relação entre duração entre uma parada e outra e a distância entre essas paradas
7) panorama do periodo do dia e duração da viagem entre duas paradas
8) Panorama entre o dia da semana e a duração da viagem entre duas paradas

analises que queremos:

1) Relação entre a hora do dia e duração de uma viagem entre duas paradas
2) Relação entre o dia da semana e a duração de uma viagem entre duas paradas
3) Relação entre a área da cidade e a duração de uma viagem entre duas paradas


## Hora do dia
Primeiro vamos plotar um gráfico de duração de viagens entre paradas por horas do dia.
```{r}
p <- ggplot(busData, aes(x = as.factor(hourOrig), y = duration, colour = problem))
p + geom_jitter(aes(alpha = 0.5))
```

Problemas encontrados:

1) Algumas durações estão negativas (pouquíssimos casos).
2) Algumas durações estão muito longas. Muitos desses casos ocorrem porque o número de viagem da origem é diferente do número de viagem do destino.

Há um problema de cálculo no preprocessamento quando a parada de origem é a última parada do shape e a parada de destino é a primeira parada do shape.
Filtrando esses casos obtemos o gŕafico abaixo.

```{r}
temp <- busData %>% filter(distanceTraveledShapeDest > 0)

p <- ggplot(temp, aes(x = as.factor(hourOrig), y = duration, colour = problem))
p + geom_jitter(aes(alpha = 0.5))
```

Há casos em que o número da viagem do ponto de origem e o número da viagem do ponto de destino não são iguais e nem consecutivos.
Filtrando esses casos obtemos o gŕafico abaixo.

```{r}
temp2 <- temp %>% filter(abs(tripNumOrig - tripNumDest) <= 1)

p <- ggplot(temp2, aes(x = as.factor(hourOrig), y = duration, colour = problem))
p + geom_jitter(aes(alpha = 0.5))
```

Há casos em que a distância entre a origem e o destino é 0, ou seja o ônibus ficou parado. Não sabemos se isso ocorre por que o ônibus realmente ficou parado ou por erros de medição.